



	<div class="container" style="margin-top: 130px">

		<div class="row">
			<aside class="col-md-4 sidebar sidebar-left" style="padding-top: 0">


				<div class="col-xs-12 text-center">
					<h2 style="margin-top:0">My Charts</h2>

					@{ Html.RenderAction("GetChartsPreview"); }
				</div>


				<div class="col-xs-12 text-center">
					<button class="btn btn-action" onclick="addChartWithData()" style="width: 230px; margin-top: 10px">
						<span class="fa fa-list" aria-hidden="true"></span>
						Add chart with data
					</button>
				</div>
				<div class="col-xs-12 text-center">
					<button class="btn btn-action" onclick="addChartWithUrl()" style="width: 230px; margin-top: 10px">
						<span class="fa fa-globe" aria-hidden="true"></span>
						Add chart with url
					</button>
				</div>

			</aside>

			<article class="col-md-8 maincontent" id="current_chart"></article>

		</div>
	</div>

	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script>
		google.load('visualization', '1.0', { packages: ['charteditor'] });
		var wrapper = new Object();

		function drawVisualization() {
			wrapper = new google.visualization.ChartWrapper({
				chartType: 'LineChart',
				dataTable: [],
				containerId: 'editorChart'
			});

		}

		function addChartWithData() {
			$.get('/Profile/CreateChart')
				.done(function (data) {
					$('#current_chart').html(data);
				});
		}

		function addChartWithUrl() {
			$.get('/Profile/CreateChart')
				.done(function (data) {
					$('#current_chart').html(data);
				});
		}

		function parseString(str, withQuotes) {
			var find = '\'';
			var pattern = new RegExp(find, 'g');
			str = str.replace(pattern, '\"');
			var re = /(?:")([^"]+)(?:")|([^\s"]+)(?=\s+|$)/g;
			var res = [], arr = null;
			while (arr = re.exec(str)) {
				if (withQuotes)
					res.push(arr[0]);
				else
					res.push(arr[1] ? arr[1] : arr[0]);
			}
			return res;
		}

		Array.prototype.clean = function (deleteValue) {
			for (var i = 0; i < this.length; i++) {
				if (this[i] == deleteValue) {
					this.splice(i, 1);
					i--;
				}
			}
			return this;
		};

		function parseData() {
			var data = $('#chartData').val();
			var lines = data.split('\n').clean("");
			var chartData = [];
			for (var i = 0; i < lines.length; i++) {
				var line = [];
				var params = [];
				var items = parseString(lines[i]);
				for (var j = 0; j < items.length; j++) {
					var f = parseFloat(items[j]);
					if (f)
						params.push(f);
					else {
						params.push(items[j]);
					}
				}
				chartData.push(line.concat(params));
			}
			wrapper.setDataTable(chartData);
		}

		function render() {
			drawVisualization();
			//$('#editorChart').width(680);
			//$('#editorChart').height(380);

			parseData();
			wrapper.draw();

			$('#chartSave').show();
		}

		function save() {
			$.ajax({
				type: "POST",
				url: '@Url.Action("SaveChart", "Profile")',
				data: JSON.stringify({ data: $('#chartData').val() }),
				dataType: "json",
				contentType: "application/json",
				complete: function (data) {
					location.reload();
				}
			});
		}

		function update(id) {
			$.ajax({
				type: "POST",
				url: '@Url.Action("UpdateChart", "Profile")',
				data: JSON.stringify({ id: id, data: $('#chartData').val() }),
				dataType: "json",
				contentType: "application/json",
				complete: function () {
					location.reload();
				}
			});
		}

		$(document).ready(function() {
			$(".chartPreview").click(function () {
				var chartId = $(this).attr('id');

				$.get('/Profile/CreateChart', { chartId: chartId })
				.done(function (data) {
					$('#current_chart').html(data);
					drawVisualization();
					render();
				});
			});

		});
	</script>
